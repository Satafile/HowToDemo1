Подробный разбор настройки GRE-туннеля на маршрутизаторе
Давайте детально разберём каждую команду в этой конфигурации, объясняя её назначение и принцип работы.

1. Вход в режимы конфигурации
bash
en
conf t
en (enable) - переход в привилегированный режим (аналог root/sudo в Linux)

conf t (configure terminal) - вход в режим глобальной конфигурации

2. Создание и настройка GRE-туннеля
bash
int tunnel.1
  ip address 10.10.10.10/30
  ip tunnel 172.16.5.14 172.16.4.14 mode gre
  ex
ex
2.1. Создание туннельного интерфейса
int tunnel.1 - создание туннельного интерфейса с номером 1

В разных устройствах синтаксис может отличаться (tunnel1, tun0 и т.д.)

2.2. Назначение IP-адреса туннелю
ip address 10.10.10.10/30 - назначение IP-адреса туннельному интерфейсу

Адрес: 10.10.10.10

Маска: /30 (255.255.255.252) - позволяет только 2 адреса в подсети

Второй адрес (10.10.10.9) будет на другом конце туннеля

2.3. Конфигурация GRE-туннеля
ip tunnel 172.16.5.14 172.16.4.14 mode gre - настройка параметров туннеля

172.16.5.14 - локальный (source) IP-адрес для туннеля

172.16.4.14 - удалённый (destination) IP-адрес для туннеля

mode gre - указание использовать протокол GRE (Generic Routing Encapsulation)

2.4. Выход из режимов конфигурации
ex (exit) - выход из конфигурации интерфейса

Второй ex - выход из режима глобальной конфигурации

3. Сохранение конфигурации
bash
wr
wr (write) - сохранение текущей конфигурации в энергонезависимую память (аналог copy running-config startup-config в Cisco IOS)

Принцип работы GRE-туннеля
Инкапсуляция трафика:

Исходные пакеты (например, с IP 192.168.1.1) инкапсулируются в GRE-заголовок

Затем добавляется новый IP-заголовок с адресами 172.16.5.14 (source) и 172.16.4.14 (destination)

Передача через сеть:

Инкапсулированные пакеты передаются как обычный IP-трафик через физические интерфейсы

Декапсуляция на удалённой стороне:

Принимающий маршрутизатор удаляет внешний IP-заголовок и GRE-заголовок

Исходный пакет обрабатывается дальше согласно таблице маршрутизации

Проверка работы туннеля
После настройки рекомендуется выполнить:

Проверить состояние туннеля:

bash
show interface tunnel.1
Проверить маршрутизацию:

bash
show ip route
Проверить связность:

bash
ping 10.10.10.9
Возможные проблемы и решения
Туннель не поднимается:

Проверить доступность удалённого адреса (ping 172.16.4.14)

Проверить, разрешён ли протокол GRE (47) в фаерволе

Нет маршрутов через туннель:

Добавить статические маршруты для нужных сетей через туннельный интерфейс

Проблемы с MTU:

Установить меньший MTU на туннельном интерфейсе (обычно 1476 для GRE поверх Ethernet)

Эта конфигурация создаёт безопасный туннель между двумя сетями, позволяя передавать трафик через промежуточные сети как если бы они были напрямую соединены.
------------------------------------BR-RTR-Tunel
en
conf t
int tunnel.1
  ip address 10.10.10.10/30
  ip tunnel 172.16.5.14 172.16.4.14 mode gre
  ex
ex
wr
