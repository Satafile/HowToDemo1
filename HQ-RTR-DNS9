Настройка DNS на сетевом оборудовании (Cisco-like CLI)
Разберём пошагово представленную конфигурацию и её назначение:

1. Вход в режим конфигурации
bash
en
conf t
en (enable) - вход в привилегированный режим

conf t (configure terminal) - вход в режим глобальной конфигурации

2. Настройка DNS-сервера
bash
ip name-server 192.168.1.2
Указывает основной DNS-сервер (в данном случае локальный BIND-сервер)

Все DNS-запросы будут отправляться на этот адрес

3. Настройка доменного имени
bash
ip domain-name au-team.irpo
Устанавливает доменное имя по умолчанию

При вводе неполных имён (например, hq-srv) будет автоматически добавляться суффикс .au-team.irpo

4. Включение DNS-резолвинга
bash
ip domain-lookup
Активирует преобразование имён в IP-адреса

Без этой команды оборудование не будет выполнять DNS-запросы

5. Удаление публичного DNS
bash
no ip name-server 77.88.8.8
Удаляет DNS-сервер Яндекса из конфигурации

Оставляем только локальный DNS для внутреннего использования

6. Сохранение конфигурации
bash
do wr
do позволяет выполнить команду в режиме конфигурации

wr (write) - сохраняет текущую конфигурацию

7. Проверка работы DNS
bash
do ping hq-srv
Тестирует:

Работу DNS (преобразование hq-srv → 192.168.1.2)

Связность с сервером

Детали работы конфигурации
Последовательность разрешения имён:

При вводе hq-srv оборудование попытается разрешить:

hq-srv.au-team.irpo (из-за ip domain-name)

hq-srv (если первый вариант не сработал)

Логика DNS-запросов:

Diagram
Code
Особенности безопасности:

Использование только внутреннего DNS ограничивает утечку информации о внутренней сети

Все имена разрешаются только через контролируемый сервер

Диагностика проблем
Если ping hq-srv не работает:

Проверьте доступность DNS-сервера:

bash
do ping 192.168.1.2
Проверьте разрешение имён:

bash
do show hosts
Проверьте настройки DNS:

bash
do show running-config | include name-server|domain
Если нужно временно отключить DNS:

bash
no ip domain-lookup
Дополнительные рекомендации
Для отладки DNS-запросов:

bash
debug ip domain
Для добавления статических записей:

bash
ip host hq-srv 192.168.1.2
Для настройки нескольких DNS-серверов:

bash
ip name-server 192.168.1.2 192.168.1.3
Эта конфигурация обеспечивает:

Централизованное управление именами через локальный DNS

Безопасность за счёт отказа от внешних DNS-серверов

Удобство работы с короткими именами хостов
----------------------HQ-RTR-DNS
en
conf t
ip name-server 192.168.1.2
ip domain-name au-team.irpo
ip domain-lookup
no ip name-server 77.88.8.8
do wr
do ping hq-srv
